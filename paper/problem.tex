% !TeX root = OptCuts.tex

\section{Problem Statement}
%\minchen{As Vova suggested, describe Self-Weighting as our main formulation before Joint Discrete-Continuous Search, so does Abstract, Introduction, and Section 4 and 5.}
% \danny{Also took a pretty heavy pass at re-organizing this section and the next.}

Given an input triangle mesh $M$ of a 3D surface with $n$ vertices we seek a locally optimal UV map with topology $T^*$ and coordinates $U^* \in \mathbb{R}^{2n}$ that are local \vova{should we say ``local'' for the problem formulation?} minimizers of the constrained parametrization problem
\begin{align}
	\min_{T,U} E_s(T) \quad s.t. \quad E_d(T,U) \leq b_d\ \ and\ \ (T, U) \in \mathcal{S}.
	\label{eq:p1}
\end{align}
\justin{Might be worth mentioning in a sentence what your representation of $T$ is.  Also I moved $b_d$ to the rhs of the inequality.} \minchen{I haven't thought about defining $T$ explicitly. If needed, it can be a vector of boolean variables representing whether each edge on the 3D surface is a seam edge, subject to manifold mesh constraints.}
\vova{Binary value over edges requires additional post-process to identify which of two vertices are duplicated and which triangles they should be assigned to. 
Why not just define a new mesh $(V_T, F_T)$ and a bijective map $f_T: F \rightarrow F_T$?}

Here $\mathcal{S}$ is the set of locally injective UV maps, $E_s$ and $E_d$ respectively measure seam quality and map distortion while $b_d$ is a user specified \emph{upper bound} on acceptable distortion of the generated map. Notice too that this optimization is always feasible as in the limit more cuts will always satisfy any  distortion bound. %\danny{If we truly want to make bijectivity a first-class component of our method (I'd suggest we do then we should add the bijectivity constraint to the optimization problem statement above and also the derivation that follows - happy to do this once we decide.}

In general, distortion measures are smooth albeit \emph{nonconvex}, while seam measures are \emph{nonsmooth} since they take a discrete jump when mesh edges are unglued.  Hence, we must address both challenges in formulating a suitable optimization method. 

%
% e.g. symmetric Dirichlet, MIPS, etc, to measure distortion over the mapped domain. In what follows, for simplicity we largely focus on the symmetric Dirichlet energy and defer examples with other distortion measures for our results to Section\ \ref{}.

%Given an input triangle mesh $M$ of a 3D surface with $n_p$ vertices and its initial UV map with topology $T^0$ and coordinates $U^0 \in \mathbb{R}^{2n_p}$, we automatically search for
%\[ \argmin_{T,U} L(T,U) \]
%where $L(T,U) = E_s(T) + \lambda E_d(T,U)$ is the total energy combining both seam energy $E_s$ and distortion energy $E_d$ with a balancing factor $\lambda \in \mathbb{R^+}$. Notice that usually $E_d$ is smooth, while $E_s$ is defined to be non-differentiable, which gives us a discrete-continuous problem.

\paragraph{Dual Objective}
We construct the Lagrangian to form the saddle-point problem~\cite{} for Equation \ref{eq:p1}:
\begin{align}
	L(T,U,\lambda) = E_s(T) + \lambda(E_d(T,U) - b_d),
	\label{eq:L}
\end{align}
%
defined over primal variables $T,U$ and dual variable $\lambda$:
%
\begin{align}
	\min_{T,U} \max_{\lambda\geq0} L(T,U,\lambda).
	\label{eq:p2}
\end{align}
%
Here $\lambda \in \mathbb{R_+}$ is the Lagrange multiplier for our distortion bound. Notice that the Lagrangian $L$ can be interpreted as a multi-objective balancing between distortion and seem quality. In this description, however, $\lambda$ effectively applies a local scaling between the seam and distortion terms that is implied %directly and automatically given 
by a user-specified distortion bound. Within our algorithm to solve \eqref{eq:p1}, $\lambda$ will thus grow as we threaten to violate our distortion bound and so prioritize distortion minimization; similarly, $\lambda$ will decrease toward $0$ as our bound is strictly satisfied to prioritize seam quality.


\paragraph{Energy Definition}
Concretely we formulate our seam measure as the normalized total seam length
\[ E_s = E_{SL} = \frac{1}{\sqrt{(\sum_{t\in\mathcal{F}} |A_t|)/\pi}} \sum_{i \in \mathcal{S}} |e_i| \]
where $\mathcal{S}$ is the set of all seam edges on the input surface, $|e_i|$ is the original length of edge $i$.
We use symmetric Dirichlet energy~\cite{Smith2015Bijective}, normalized by surface area, to measure distortion over the mapped domain
\[ E_d = E_{SD} = \frac{1}{\sum_{t\in\mathcal{F}} |A_t|} \sum_{t\in\mathcal{F}} |A_t|(\sigma_{t,1}^2 + \sigma_{t,2}^2 + \sigma_{t,1}^{-2} + \sigma_{t,2}^{-2}) \]
where $\mathcal{F}$ is the set of all triangles, $|A_t|$ is the area of triangle $t$ on the input surface, and $\sigma_{t,i}$ is the $i$-th singular value of the deformation gradient of triangle $t$.
We picked this distortion measure among other choices since it efficiently balances between angle and area distortion and preserves local injectivity, however, our method can be used with other metrics as well.
\vova{should we that seam penalties and distortion measure choices are analogues to AutoCuts (but our objective is defined differently?)}

With the energies normalized, our $L$ is invariant of coordinate scale and resolution for meshes with the same shape.


\paragraph{Energy with Global Bijectivity}
For most texture applications one needs to ensure global bijecivity, we incorporate this into our energy following Jiang et al.~\shortcite{Jiang2017Simplicial}. This is realized by repeatedly triangulating the void regions of the UV maps and augment our $E_d$ with a degeneracy prevention energy for the added triangles during the optimization. Note that the augmented energy is not considered when checking the distortion bound. Moreover, our framework stays the same when solving this extended problem.

% \danny{Moved and reorganized a good portion of what was here to the next section.}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\paragraph{Joint Discrete-Continuous Search}
%
%Instead of trying to solve an ill-conditioned real-valued optimization by approximating $T$ with $U$ \cite{Poranne2017Autocuts}, we alternatingly optimize $T$ (in topology steps) and $U$ (in descent steps), augmenting the continuous search with a discrete topology search (Section~\ref{sec:DCSearch}).
%
%Descent steps deal with the continuous search
%$\min_U E_d$
%where $T$ is fixed and Newton-type method is applied (Section~\ref{sec:descentStep}).
%Topology steps deal with the discrete search (Section~\ref{sec:topologyStep}) where a neighboring topology is searched based on the first-order reduction it would cause in $L$.
%While each descent step is one complete Newton-type iteration with back-tracking line search, we use a sequence of topology steps alternated with descent steps to perform a forward line search in topology space: a search direction is first decided and then the step size is increased to ensure sufficent energy decrease.
%
%Given a topology change, we evaluate the first-order reduction of $L$ it would cause by minimizing $E_d$ only on the local stencil of the edited seam edge and combine it with the $E_s$ change. Experiments demonstrate that this is efficient and sufficient for always editing the seams reasonably and sustainably (Section~\ref{sec:results_exp}).
%
%Since we ensure $L$ to be monotonically decreased in both the descent steps and topology steps, we can easily prove that a near-stationary point can be reached for any input within a bounded number of alternations (Section~\ref{sec:convergence}).

%\paragraph{Self-Weighted Objective}
%
%To automatically decide $\lambda$ and enable users to directly control the distortion they expect for the output UV map, we formulate a constrained optimization seeking to minimize seam energy $E_s$ subject to user-specified distortion bounds $b_d$:
%\[ \min_{T,U} E_s(T) \quad s.t. \quad E_d(T,U) - b_d \leq 0 \]
%Introducing $\lambda$ as a dual variable gives us
%\[ \min_{T,U} \max_{\lambda \in \mathbb{R^+}} E_s(T) + \lambda(E_d(T,U) - b_d) \]
%We solve it by adding a regularization term to make it smooth for $\lambda$, and alternatingly updating dual variable $\lambda$ and primal variables $T$ and $U$ (Section~\ref{sec:self_weighting}).
%
%The challenge here is that the initial embedding we start from is usually with high distortion, thus infeasible, and the quality of the output seams is highly affected by the $\lambda$ updating scheme. \minchen{[TODO] briefly describe what we do after finalized}
 
 %\danny{I haven't commented it the next paragraph but would suggest we: 1. remove this next paragraph from paper, 2. make bijection a main part of the algorithm and 3. move everything else to future work (if we don't do it) or results (if we do get to it).}\justin{cool w me} 

% \vova{
% I think the structure is a bit confusing (e.g., problem is not entirely defined in ``problem statement'', since we lack precise energy formulation, self-weighted objective talks about outer-look  (alg 1) and then about self-weighting. 
% %
% I propose the following structure: \\
% Section 3: first three paragraphs followed by ``dual objective'' (i.e., exclude "concretely we formulate ...)\\
%  - then write ``energy definition'' paragraph (from sec 5.3 and ``concretely we formulate'' paragraph) \\
 % - then write ``energy with global bijectivity'' paragraph (start ``for most texture applications one needs to ensure global bijecivity, we incorporate this into our energy following Jiang2017...'') \\
 % - [this and below is optional] then write ``optimization framework'' paragraph with Algortihm 1 and first paragraph from section 4. Here reference section 4 for dual update and section 5 for primal update. \\
 % - Note due to the last paragraph, we might change this section from ``Problem Statement'' to ``Optimization Framework''. Alternatively, we can have a separate section (between current 3 and 4, titled ``optimization framework'')\\
 % - Initialization (obtaining $T^0, U^0$ is not described anywhere. We should at least mention it in ``optimization framework'' part of the text. \\
% Section 4: rename into Dual Update \\
% Section 5: rename into Primal Update
% }

\vova{I suggest we consistently use paragraphs or subsections across sec 3, 4, 5}