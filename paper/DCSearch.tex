% !TeX root = OptCuts.tex

\section{Joint Discrete-Continuous Search}

The UV topology space we are searching in can be represented using a directed graph $G_T$ with its vertices $v_T \in V_T$ being all possible UV topologies of a given 3D surface, and its edges $e_T \in E_T$ are the basic topological operations conducted on the UV map that can transform one UV topology to a nearby topology. Currently we support boundary and interior vertex split, and corner vertex merge operation.
We define the value $f_v$ of vertex $v_{T,i}$ as 
\[ f_v(v_{T,i}) = \min_{U} E_w(T_i, U) = E_s(T_i) + \min_{U} E_d(T_i, U) \]
and the weights $f_e$ of edge $e_{T,m}$ from $v_{T,i}$ to $v_{T,j}$ as 
\[ f_e(e_{T,m}) = f_v(v_{T,j}) - f_v(v_{T,i}) \]
Thus our problem could be restated as to search for a $v_{T,i}$ in $G_T$ where all edges started from it satisfies $f_e \geq 0$.

However, computing $f_v$ for one UV topology requires a proper setting of initial UV coordinates plus a whole process of real-valued optimization. In addition, even the number of neighbors of one UV topology is in the scale of $n_v$. These in practice prevent us from treating our problem as a usual graph search problem. Consequently, we construct a single search path on $G_T$ and only approximate $f_v$ in a topological first-order manner to guide the search, where intermediate UV maps are served as the initial points of the next search step.

\begin{algorithm}[h]
\SetAlgoLined
\KwData{Input surface, $U_0$, $T_0$}
\KwResult{$U_n$, $T_n$}
$j \leftarrow 1$\;
\Do{not converged}
{
	descent step $j$\;
	$U_{j+1} \leftarrow U^a_j$, $j \leftarrow j+1$\;
}
\Do{either step not converged}
{
	descent step $j$\;
	\eIf{descent step converged}
	{
		$V^j_{T,C} \leftarrow filtered$\;
	}
	{
		$V^j_{T,C} \leftarrow fracture tail$\;
	}
	topology step $j$\;
	$j \leftarrow j+1$\;
}
\caption{Joint Discrete-Continuous Search}
\label{alg:DCSearch}
\end{algorithm}

Given the initial UV map $(T_0, U_0)$, we first compute $\min_U E_d(T_0,U)$ by iterating on descent steps only. After we get the stationary UV map with $T_0$, we start the joint discrete-continuous search that keeps minimizing $E_w$ (See \autoref{alg:DCSearch}). Similar to continuous search in descent steps (\autoref{alg:descentStep}), topology search is also composed of two stages - first decide a search direction (initiating a seam edit), and then compute a proper step size (extending the edit) to ensure sufficient energy decrease. Apparently there's no point to search for every neighboring UV topology since, for example, initiating a cut in near-isometric regions won't help improve the map much. Thus we have a filtered candidate neighbor set for each topology step. When deciding a direction, we fill the set with all potentially good neighbors, when computing the step size, we fill the set with only the vertex that's newly presented on the boundary in order to see whether the operation could be extended.
\minchen{neighbor v.s. operation?}
topology steps alone is not good. The alternated descent steps between the topology steps are for setting the threshold for sufficient energy decrease criteria, which can also be understood as we always perform the one between continuous and discrete action whichever decreases $E_w$ more.

If after a descent step, $f_v(v_{T,i}) \geq f_v(v_{T,i-1})$ is detected, we stop the process by rolling back to $v_{T,i-1}$, which is the stationary of $E_w$ w.r.t. both UV topology (in an approximation sense) and coordinates that we are searching for.

\subsection{Energy Definition}

To start with, we use symmetric Dirichlet energy~\cite{Smith2015Bijective} as our distortion energy, normalized by surface area:
\[ E_d = E_{SD} = \frac{1}{\sum_{t\in\mathcal{F}} |A_t|} \sum_{t\in\mathcal{F}} |A_t|(\sigma_{t,1}^2 + \sigma_{t,2}^2 + \sigma_{t,1}^{-2} + \sigma_{t,2}^{-2}) \]
where $\mathcal{F}$ is the set of all triangles, $|A_t|$ is the area of triangle $t$ on the input surface, and $\sigma_{t,i}$ is the $i$-th singular value of the deformation gradient of triangle $t$.

For seam energy, we simply use a normalized seam length:
\[ E_s = E_{SL} = \frac{1}{\sqrt{(\sum_{t\in\mathcal{F}} |A_t|)/\pi}} \sum_{i \in \mathcal{S}} |e_i| \]
where $\mathcal{S}$ is the set of all seam edges on the input surface, $|e_i|$ is the original length of edge $i$.

With the energies normalized, our $E_w$ is invariant of coordinate scale and resolution for meshes with the same shape.

\input{descentSteps}

\input{topologySteps}

\subsection{Convergence}
\label{sec:convergence}

As our method is defined to guarantee convergence, we now analyze the convergence rate. First, it is easy to see that $E_w$ is monotonically decreasing looking at each end of descent steps \minchen{[NOTE] might change to abandon roll back}. Now we look at descent step $i$ and $i+1$, from $E^i_w \geq E^{i+1}_w$ we have
\[ E^i_{SD} - E^{i+1}_{SD} \geq \frac{\lambda}{1-\lambda} (E^{i+1}_{se} - E^i_{se}) \geq \frac{\lambda}{1-\lambda} \frac{1}{\sqrt{(\sum_t |A_t|)/\pi}} |e|_{min} \]
if we now only consider splitting operations that keep increasing $E_{se}$. It's obvious that $E_{SD}$'s theoretical lower bound is defined to be $4$, so we have
\[ n_{alter} \leq \frac{(1-\lambda)\sqrt{(\sum_t |A_t|)/\pi}}{\lambda|e|_{min}} (E^0_{SD} - 4) \]
The most important hint we can read from this is, to accelerate convergence, we can move through multiple vertices on $G_T$ in each topology step to increase $E^{i+1}_{se} - E^i_{se}$.

\minchen{[TODO] update the proof with merge operations?}