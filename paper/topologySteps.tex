% !TeX root = OptCuts.tex

\subsection{Topology Steps}
\label{sec:topologyStep}
\danny{This is also a ``descent'' step - suggest as I did above to rename to something like ``discrete'' or ``topology'' descent step.}

In topology steps, starting from the UV map given by last descent step, we move to a neighboring UV topology with the best first-order reduction in $E_w$, conducting a basic topological operation searched from the given operation set $\hat{\mathcal{E}}^i_T$. The UV coordinates of the edited seam vertices will also be updated. If the first-order reduction does not satisfy the threshold $\delta^i$ given by the last descent step, however, nothing will be changed.

\begin{algorithm}[h]
\SetAlgoLined
\KwData{$M$, $T^i$, $U^i$, $\hat{\mathcal{E}}^i_T$, $\delta^i$}
\KwResult{$T^{i+1}$, $U_a^{i}$}
\For{each $e^{i,j}_{T}$ in $\hat{\mathcal{E}}^i_T$}{
  $\hat{f}_e(e^{i,j}_{T}) \leftarrow \Big(E^j_s + \lambda \min_{U^{i,j}} E_d(T^j,U)\Big) - E^i_{w}$\;
}
$U_a^{i} \leftarrow U^i$\;
\If{$\min_{e^{i,j}_{T} \in \hat{\mathcal{E}}^i_T} \hat{f}_e(e^{i,j}_{T}) \leq \delta^i$}
{
  $T^{i+1} \leftarrow T^j$, $U_a^{i,j} \leftarrow \argmin_{U^{i,j}} E_d(T^j,U)$\;
}
\caption{Topology Step $j$}
\end{algorithm}

We compute the first-order reduction \justin{is this defined in an equation?} of $E_w$ from $T^i$ to $T^j$ for all $e^{i,j}_T \in \mathcal{E}^i_T$ in parallel, and only moves to \justin{didn't parse ``moves to''} $v^j_T$ with smallest $\hat{f}_e(e^{i,j}_{T})$, if this energy decrease is smaller than $\delta^i$. Recall that the threshold $\delta^i$ is set as the energy decrease in the current descent step. For deciding a search direction, $\delta^i$ is near $0$ as the current descent step converged, while for computing the topology step size, $\delta^i$ is not $0$. This together let our alternating process always pick the search step (continous or discrete) that decrease $E_w$ more to perform.

\paragraph{First-Order Reduction}
After making copies of the one-ring stencil of each candidate vertex to be split or merged, we split or merge them following all possible edge combinations in parallel, and optimize $E_d$ on them with the one-ring neighbors fixed. Since fewer than 2 vertices \justin{one?} are free to move, the system sizes only ranges from 2 to 4 degrees of freedom, which can be computed more efficiently rather than evaluating the true $f_v$ for deciding where to go next on $\mathcal{G}_T$.

For splits, the initial position of the split vertex can just be the original position before splitting. For corner merges, however, the merged vertex must have a locally-injective initial position\justin{neighborhood?}. Instead of potentially minimizing a distance measure subject to a set of linear inequality constraints preventing element inversion, we first pose the merged vertex to the averaged position of the two vertices been merged, if element inversion is detected, we then apply relaxation method~\cite{Agmon1954Relaxation} to iteratively project from the averaged position to a inversion free position. \justin{previous sentence is a run-on} However, cases are still there when only moving the merged vertex is not enough to obtain an inversion free initial point. In these situations, we will just abandon the candidate, which rarely happens in practice and does not affect our result.\justin{didn't follow the last two sentences, maybe needs a small figure}

Splitting a boundary vertex along an edge that connects to another boundary vertex will remove a hole or produce an extra chart in our UV map. For this case, we free both the 2 boundary vertices while computing the energy decrease on the first-order stencil. \minchen{[TODO] 4-vertex merge to support joining two charts together, triangle moving operations?}